# This is a parry simulator! It currently works for 4 APR enemy only.
# It calculates the chance of being hit per attack and the chance of riposte.

parry_sim <- function(
  epic_dodge, #         accepts T or F, checks for player's epic dodge, default F
  concealment, #        accepts T or F, checks for player's concealment, default F
  parry, #              accepts any integer, sets player parry
  ac, #                 accepts any integer, sets player AC
  enemy_ab #            accepts any integer, sets enemy AB
){
  # setting defaults
  if(missing(epic_dodge)){epic_dodge = F}
  if(missing(concealment)){concealment = F}
  
  if(missing(parry)){print("Give value for parry")}
  if(missing(ac)){print("Give value for ac")}
  if(missing(enemy_ab)){print("Give value for enemy_ab")}
  
  # this function sets up all possible enemy attack rolls
  attack_rolls <- function(enemy_ab_val){
    enemy_ab_val <- enemy_ab
    attacks <- c()
    for(i in 1:20) {
      attacks <- append(attacks, seq(enemy_ab_val, enemy_ab_val-15, -5) + i)
    }
    return(attacks)
  }
  
  # this function sets up all possible parry rolls
  parry_rolls <- function(parry_val) {
    parry_val <- parry
    parries <- c()
    for(i in 1:20) {
      parries <- append(parries, parry_val + i)
    }
    return(parries)
  }
  
  # this calculates the mean of parry failing per attack
  parry_fails <- parry_rolls() >= attack_rolls()
  if(epic_dodge == T) {
    parry_fails[seq(40, length(parry_fails), 20)] <- F # assigns nat20s for epic dodge
  } else {
    parry_fails[seq(20, length(parry_fails), 20)] <- F # assigns nat20s for no epic dodge
  }
  chance_parry_fail <- length(parry_fails[parry_fails == F])/length(parry_fails)
  
  # this calculates the mean of AC failing per attack
  ac_fails <- ac  > attack_rolls()
  if(epic_dodge == T){
    ac_fails[seq(40, length(ac_fails), 20)] <- F # assigns nat20s for epic dodge
  } else {
    ac_fails[seq(20, length(ac_fails), 20)] <- F # assigns nat20s for epic dodge
  }
  chance_ac_fail <- length(ac_fails[ac_fails == F])/length(ac_fails)
  
  if (concealment == T){
    # the chance of getting hit without concealment or epic dodge
    chance_hit <- chance_parry_fail * chance_ac_fail * 0.75
  } else {
    # the chance of getting hit with concealment and no epic dodge
    chance_hit <- chance_parry_fail * chance_ac_fail
  }
  # outputs the chance of being hit with attack post conditions
  return(chance_hit)
}

##### FUNCTION ENDS HERE

# an example of using the function
parry_sim(parry=73, ac=58, enemy_ab=58, epic_dodge = F, concealment = T)
